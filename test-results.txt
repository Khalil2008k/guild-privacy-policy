
> guild-2@1.0.0 test
> jest --verbose

node.exe : PASS src/utils/__tests__/validation.test.ts
At line:1 char:1
+ & "C:\Program Files\nodejs/node.exe" "C:\Program Files\nodejs/node_mo ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (PASS src/utils/...idation.test.ts:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  Validation Utils
    validateEmail
      ΓêÜ should validate correct email addresses (9 ms)
      ΓêÜ should reject invalid email addresses (1 ms)
      ΓêÜ should handle empty string
    validatePassword
      ΓêÜ should validate strong passwords (2 ms)
      ΓêÜ should reject weak passwords (1 ms)
      ΓêÜ should check minimum length
      ΓêÜ should check for uppercase letter (1 ms)
      ΓêÜ should check for lowercase letter
      ΓêÜ should check for number (1 ms)
    validatePhoneNumber
      ΓêÜ should validate correct phone numbers
      ΓêÜ should reject invalid phone numbers (1 ms)
    sanitizeInput
      ΓêÜ should remove dangerous characters
      ΓêÜ should trim whitespace
      ΓêÜ should handle empty string (1 ms)
    validateRequired
      ΓêÜ should validate non-empty strings
      ΓêÜ should reject empty strings

PASS tests/__tests__/chat.test.ts
  Chat System Tests
    Messaging
      ΓêÜ should send text message (8 ms)
      ΓêÜ should send image message (1 ms)
      ΓêÜ should mark message as read
    Real-time Communication
      ΓêÜ should receive messages in real-time (2 ms)
      ΓêÜ should emit typing indicator (1 ms)
    Dispute Logging
      ΓêÜ should log message for dispute (1 ms)
      ΓêÜ should retrieve chat history for dispute (1 ms)

PASS BROKEN_APP_BACKUP/src/utils/__tests__/validation.test.ts
  Validation Utilities
    sanitizeInput
      ΓêÜ should remove script tags (8 ms)
      ΓêÜ should remove javascript: URLs (1 ms)
      ΓêÜ should remove HTML tags
      ΓêÜ should handle empty strings (1 ms)
      ΓêÜ should handle non-string input
    validateJobTitle
      ΓêÜ should validate correct job title (1 ms)
      ΓêÜ should reject empty title
      ΓêÜ should reject title too short (1 ms)
      ΓêÜ should reject title too long
      ΓêÜ should accept Arabic text (1 ms)
    validateCompanyName
      ΓêÜ should validate correct company name
      ΓêÜ should reject empty company name
      ΓêÜ should reject company name too short (1 ms)
    validateJobDescription
      ΓêÜ should validate correct description
      ΓêÜ should reject empty description
      ΓêÜ should reject description too short (1 ms)
      ΓêÜ should reject description too long
    validateSkills
      ΓêÜ should validate correct skills array
      ΓêÜ should reject empty skills array (1 ms)
      ΓêÜ should reject non-array input
      ΓêÜ should reject too many skills
      ΓêÜ should reject empty skill in array
    validateEmail
      ΓêÜ should validate correct email
      ΓêÜ should reject invalid email format (1 ms)
      ΓêÜ should reject empty email
    validatePhoneNumber
      ΓêÜ should validate correct phone number
      ΓêÜ should reject phone number too short (1 ms)
      ΓêÜ should reject phone number too long
    validateJobForm
      ΓêÜ should validate correct job form
      ΓêÜ should return multiple errors for invalid form
    validateSearchQuery
      ΓêÜ should validate correct search query
      ΓêÜ should sanitize search query (1 ms)
      ΓêÜ should reject query too long
    RateLimiter
      ΓêÜ should allow first attempt (1 ms)
      ΓêÜ should block after max attempts
      ΓêÜ should reset after time window (128 ms)
      ΓêÜ should return remaining time (1 ms)

  console.log
    ≡ƒîì Environment initialized: {
      environment: 'development',
      apiUrl: 'http://192.168.1.34:5000/api',
      features: {
        enableAnalytics: false,
        enableCrashlytics: false,
        enablePerformanceMonitoring: true,
        enableDebugMode: true,
        enableTestData: true,
        enableBetaFeatures: true,
        enableAppCheck: false
      },
      logging: { level: 'debug', enableConsole: true, enableRemote: false }
    }

      at log (src/config/environment.ts:289:13)

PASS backend/src/services/__tests__/UserService.test.ts
  UserService
    createUser
      ΓêÜ should create a new user successfully (2 ms)
      ΓêÜ should throw error for missing required fields (17 ms)
    getUserById
      ΓêÜ should retrieve user by ID
      ΓêÜ should return null for non-existent user (1 ms)
      ΓêÜ should throw error for missing user ID (1 ms)
    getUserByEmail
      ΓêÜ should retrieve user by email
      ΓêÜ should return null for non-existent email (1 ms)
      ΓêÜ should throw error for missing email
    updateUser
      ΓêÜ should update user successfully
      ΓêÜ should throw error for non-existent user (1 ms)
      ΓêÜ should throw error for missing user ID (1 ms)
    deleteUser
      ΓêÜ should delete user successfully
      ΓêÜ should throw error for non-existent user (1 ms)
      ΓêÜ should throw error for missing user ID (1 ms)
    searchUsers
      ΓêÜ should search users by name (1 ms)
      ΓêÜ should search users by email
      ΓêÜ should return empty array for empty query (2 ms)
    updateUserProfile
      ΓêÜ should update user profile successfully (1 ms)
      ΓêÜ should throw error for missing user ID (1 ms)
    getUserStats
      ΓêÜ should retrieve user statistics (1 ms)
      ΓêÜ should throw error for missing user ID (1 ms)
    deactivateUser
      ΓêÜ should deactivate user successfully
      ΓêÜ should throw error for non-existent user (1 ms)
    reactivateUser
      ΓêÜ should reactivate user successfully
      ΓêÜ should throw error for non-existent user (1 ms)

PASS src/hooks/__tests__/useFormValidation.test.ts
  useFormValidation Hook
    ΓêÜ should initialize with correct default values (1 ms)
    ΓêÜ should provide handleChange function
    ΓêÜ should provide handleSubmit function (1 ms)
    ΓêÜ should provide validateForm function
    ΓêÜ should provide reset function
    ΓêÜ should handle form submission (1 ms)
    ΓêÜ should handle form reset
    ΓêÜ should validate individual fields (1 ms)
    ΓêÜ should handle change events (1 ms)

info: ≡ƒöÑ Firebase Admin initialized successfully {"service":"guild-backend","timestamp":"2025-10-13T19:00:35.476Z"}
  console.log
    ≡ƒöì i18n module [ios]: Starting initialization...

      at Object.log (src/i18n/index.ts:46:9)

  console.log
    ≡ƒöì i18n module [ios]: Starting initialization...

      at Object.log (src/i18n/index.ts:46:9)

PASS backend/src/routes/__tests__/auth.test.ts
  Auth Routes
    POST /register
      ΓêÜ should register a new user successfully (2 ms)
      ΓêÜ should reject registration with missing fields (1 ms)
      ΓêÜ should reject registration with invalid email
      ΓêÜ should reject registration with weak password (1 ms)
    POST /login
      ΓêÜ should login user successfully (1 ms)
      ΓêÜ should reject login with missing credentials
      ΓêÜ should reject login with invalid email (1 ms)
      ΓêÜ should reject login with invalid password
    GET /verify
      ΓêÜ should verify valid token
      ΓêÜ should reject request without token (1 ms)
      ΓêÜ should reject invalid token

  console.log
    i18n setup complete (async initialization in progress)

      at Object.log (src/i18n/index.ts:73:9)

  console.log
    i18n setup complete (async initialization in progress)

      at Object.log (src/i18n/index.ts:73:9)

PASS src/contexts/__tests__/ThemeContext.test.tsx
  ThemeContext
    ΓêÜ should provide theme context (289 ms)
    ΓêÜ should handle theme switching (1 ms)
    ΓêÜ should persist theme preferences (1 ms)

  console.log
    ≡ƒöì i18n module [ios]: Starting initialization...

      at Object.log (src/i18n/index.ts:46:9)

  console.log
    i18n setup complete (async initialization in progress)

      at Object.log (src/i18n/index.ts:73:9)

PASS src/config/__tests__/environment.test.ts
  Environment Configuration
    getEnvironmentConfig
      ΓêÜ should return development config (2 ms)
      ΓêÜ should return staging config
      ΓêÜ should return production config
      ΓêÜ should default to development config
    Firebase Configuration
      ΓêÜ should return valid Firebase config
      ΓêÜ should have consistent project ID
    Feature Flags
      ΓêÜ should check if analytics is enabled (1 ms)
      ΓêÜ should check if push notifications are enabled
      ΓêÜ should check if biometric auth is enabled
      ΓêÜ should check if guild map is enabled in development (1 ms)
      ΓêÜ should check if guild map is disabled in production
    API Configuration
      ΓêÜ should return correct API base URL for development
      ΓêÜ should return correct API base URL for staging (5 ms)
      ΓêÜ should return correct API base URL for production
    Configuration Consistency
      ΓêÜ should have all required configuration keys (1 ms)
      ΓêÜ should have all required feature flags

  console.log
    ≡ƒîì Environment initialized: {
      environment: 'development',
      apiUrl: 'http://192.168.1.34:5000/api',
      features: {
        enableAnalytics: false,
        enableCrashlytics: false,
        enablePerformanceMonitoring: true,
        enableDebugMode: true,
        enableTestData: true,
        enableBetaFeatures: true,
        enableAppCheck: false
      },
      logging: { level: 'debug', enableConsole: true, enableRemote: false }
    }

      at log (src/config/environment.ts:289:13)

  console.log
    ≡ƒîì Environment initialized: {
      environment: 'development',
      apiUrl: 'http://192.168.1.34:5000/api',
      features: {
        enableAnalytics: false,
        enableCrashlytics: false,
        enablePerformanceMonitoring: true,
        enableDebugMode: true,
        enableTestData: true,
        enableBetaFeatures: true,
        enableAppCheck: false
      },
      logging: { level: 'debug', enableConsole: true, enableRemote: false }
    }

      at log (src/config/environment.ts:289:13)

  console.log
    Γ£à i18n [ios] initialized successfully

      at log (src/i18n/index.ts:67:13)

  console.log
    Γ£à i18n [ios] initialized successfully

      at log (src/i18n/index.ts:67:13)

  console.log
    Γ£à i18n [ios] initialized successfully

      at log (src/i18n/index.ts:67:13)

  console.log
    ≡ƒöÑ JOB SERVICE: Creating job with data: {
      title: 'Build Mobile App',
      description: 'Need a React Native developer',
      category: 'Development',
      budget: 5000,
      currency: 'QR',
      location: 'Doha, Qatar',
      requiredSkills: [ 'React Native', 'TypeScript' ],
      urgent: false
    }

      at JobService.log (src/services/jobService.ts:116:15)

  console.log
    ≡ƒöÑ JOB SERVICE: Creating job with data: { title: '', description: '' }

      at JobService.log (src/services/jobService.ts:116:15)

PASS tests/__tests__/performance.test.ts
  Performance Tests
    Load Testing
      ΓêÜ should handle 100 concurrent job listings (2 ms)
      ΓêÜ should handle 50 concurrent user sign-ins (1 ms)
    API Response Times
      ΓêÜ GET /api/v1/jobs should respond in < 500ms
      ΓêÜ POST /api/v1/jobs should respond in < 1000ms (1 ms)
    Memory Usage
      ΓêÜ should not leak memory during 1000 operations (3 ms)

  console.log
    ≡ƒöÑ JOB SERVICE: Creating job with data: {
      id: 'job-123',
      title: 'Test Job',
      description: 'This is a test job',
      category: 'Development',
      budget: -100,
      currency: 'QR',
      location: 'Doha, Qatar',
      latitude: 25.2854,
      longitude: 51.531,
      status: 'open',
      postedBy: 'user-123',
      postedAt: 2025-10-13T19:00:35.808Z,
      expiresAt: 2025-11-12T19:00:35.808Z,
      requiredSkills: [ 'JavaScript', 'React Native' ],
      urgent: false
    }

      at JobService.log (src/services/jobService.ts:116:15)

  console.log
    ≡ƒöÑ JOB SERVICE: Creating job with data: {
      id: 'job-123',
      title: 'Test Job',
      description: 'This is a test job',
      category: 'Development',
      budget: 500,
      currency: 'QR',
      location: 'Doha, Qatar',
      latitude: 25.2854,
      longitude: 51.531,
      status: 'open',
      postedBy: 'user-123',
      postedAt: 2025-10-13T19:00:35.814Z,
      expiresAt: 2025-11-12T19:00:35.814Z,
      requiredSkills: [ 'JavaScript', 'React Native' ],
      urgent: false
    }

      at JobService.log (src/services/jobService.ts:116:15)

  console.log
    ≡ƒöÑ JOB SERVICE: Creating job with data: {
      id: 'job-123',
      title: 'Test Job',
      description: 'This is a test job',
      category: 'Development',
      budget: 500,
      currency: 'QR',
      location: 'Doha, Qatar',
      latitude: 25.2854,
      longitude: 51.531,
      status: 'open',
      postedBy: 'user-123',
      postedAt: 2025-10-13T19:00:35.818Z,
      expiresAt: 2025-11-12T19:00:35.818Z,
      requiredSkills: [ 'JavaScript', 'React Native' ],
      urgent: false
    }

      at JobService.log (src/services/jobService.ts:116:15)

  console.log
    ≡ƒöÑ JOB SERVICE: Getting open jobs...

      at JobService.log (src/services/jobService.ts:438:15)

  console.log
    ≡ƒô▒ Notification would be sent: {
      userId: 'job-123',
      title: 'Job Cancelled',
      body: 'The job has been cancelled.'
    }

      at JobService.log (src/services/jobService.ts:557:15)

  console.log
    ≡ƒô▒ Notification would be sent: {
      userId: 'job-123',
      title: 'Job Cancelled',
      body: 'The job has been cancelled.'
    }

      at JobService.log (src/services/jobService.ts:557:15)

  console.log
    ≡ƒô▒ Notification would be sent: {
      userId: 'job-123',
      title: 'Job Cancelled',
      body: 'The job has been cancelled.'
    }

      at JobService.log (src/services/jobService.ts:557:15)

PASS src/components/__tests__/Button.test.tsx
  Button Component
    ΓêÜ should render button with title (606 ms)
    ΓêÜ should call onPress when pressed (5 ms)
    ΓêÜ should not call onPress when disabled (4 ms)
    ΓêÜ should render primary variant correctly (4 ms)
    ΓêÜ should render secondary variant correctly (3 ms)
    ΓêÜ should show disabled state correctly (9 ms)

FAIL tests/__tests__/payments.test.ts
  Payment System Tests (Guild Coins)
    Wallet Management
      ΓêÜ should initialize wallet with 300 Guild Coins for new users (7 ms)
      ΓêÜ should fetch current wallet balance (1 ms)
      ΓêÜ should show transaction history (2 ms)
    Job Payments
      ΓêÜ should deduct Guild Coins when posting a job (1 ms)
      ├ù should fail payment if insufficient balance (13 ms)
      ├ù should hold payment until job completion (2 ms)
      ├ù should release payment to worker on job completion (1 ms)
      ├ù should refund payment on job cancellation (1 ms)
    Transaction Verification
      ΓêÜ should verify transaction exists (1 ms)
      ├ù should validate transaction integrity (1 ms)
      ├ù should detect fraudulent transactions (1 ms)
    Payment Recovery
      ├ù should retry failed payment (1 ms)
      ├ù should rollback failed transaction
    Payment Analytics
      ├ù should calculate total earnings
      ├ù should calculate total spending (1 ms)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should fail payment if insufficient balance

    expect(received).rejects.toThrow(expected)

    Expected substring: "Insufficient balance"
    Received message:   "Failed to process job payment"

          171 |
          172 |     if (!response.ok) {
        > 173 |       throw new Error('Failed to process job payment');
              |             ^
          174 |     }
          175 |
          176 |     return response.json();

      at PaymentService.<anonymous> (src/services/paymentService.ts:173:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/payments.test.ts:100:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should hold payment until job completion

    TypeError: paymentService.holdPayment is not a function

      110 |       );
      111 |
    > 112 |       const result = await paymentService.holdPayment({
          |                                           ^
      113 |         jobId: 'job-123',
      114 |         amount: 50,
      115 |       });

      at Object.holdPayment (tests/__tests__/payments.test.ts:112:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should release payment to worker on job completion

    TypeError: paymentService.releasePayment is not a function

      128 |       );
      129 |
    > 130 |       const result = await paymentService.releasePayment('job-123');
          |                                           ^
      131 |
      132 |       expect(result.released).toBe(true);
      133 |       expect(result.amount).toBe(50);

      at Object.releasePayment (tests/__tests__/payments.test.ts:130:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should refund payment on job cancellation

    TypeError: paymentService.refundPayment is not a function

      143 |       );
      144 |
    > 145 |       const result = await paymentService.refundPayment('job-123');
          |                                           ^
      146 |
      147 |       expect(result.refunded).toBe(true);
      148 |       expect(result.amount).toBe(50);

      at Object.refundPayment (tests/__tests__/payments.test.ts:145:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Transaction Verification ΓÇ║ should validate transaction integrity

    TypeError: paymentService.verifyTransaction is not a function

      169 |       );
      170 |
    > 171 |       const result = await paymentService.verifyTransaction('txn-123');
          |                                           ^
      172 |
      173 |       expect(result.valid).toBe(true);
      174 |       expect(result.verified).toBe(true);

      at Object.verifyTransaction (tests/__tests__/payments.test.ts:171:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Transaction Verification ΓÇ║ should detect fraudulent transactions

    TypeError: paymentService.processPayment is not a function

      181 |
      182 |       await expect(
    > 183 |         paymentService.processPayment({ amount: 10000 })
          |                        ^
      184 |       ).rejects.toThrow('Transaction flagged as suspicious');
      185 |     });
      186 |   });

      at Object.processPayment (tests/__tests__/payments.test.ts:183:24)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Recovery ΓÇ║ should retry failed payment

    TypeError: paymentService.retryPayment is not a function

      192 |         .mockResolvedValueOnce(mockApiResponse({ success: true }));
      193 |
    > 194 |       const result = await paymentService.retryPayment('txn-123');
          |                                           ^
      195 |
      196 |       expect(result.success).toBe(true);
      197 |     });

      at Object.retryPayment (tests/__tests__/payments.test.ts:194:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Recovery ΓÇ║ should rollback failed transaction

    TypeError: paymentService.rollbackTransaction is not a function

      202 |       );
      203 |
    > 204 |       const result = await paymentService.rollbackTransaction('txn-123');
          |                                           ^
      205 |
      206 |       expect(result.rolledBack).toBe(true);
      207 |       expect(result.refunded).toBe(true);

      at Object.rollbackTransaction (tests/__tests__/payments.test.ts:204:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Analytics ΓÇ║ should calculate total earnings

    TypeError: paymentService.getTotalEarnings is not a function

      218 |       );
      219 |
    > 220 |       const result = await paymentService.getTotalEarnings('user-123');
          |                                           ^
      221 |
      222 |       expect(result.totalEarnings).toBe(500);
      223 |       expect(result.transactionCount).toBe(10);

      at Object.getTotalEarnings (tests/__tests__/payments.test.ts:220:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Analytics ΓÇ║ should calculate total spending

    TypeError: paymentService.getTotalSpending is not a function

      232 |       );
      233 |
    > 234 |       const result = await paymentService.getTotalSpending('user-123');
          |                                           ^
      235 |
      236 |       expect(result.totalSpending).toBe(200);
      237 |       expect(result.transactionCount).toBe(4);

      at Object.getTotalSpending (tests/__tests__/payments.test.ts:234:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

FAIL tests/__tests__/auth.test.ts
  Authentication Flow Tests
    User Registration
      ΓêÜ should successfully register a new user with email and password (11 ms)
      ΓêÜ should fail registration with invalid email (7 ms)
      ├ù should fail registration with weak password (5 ms)
      ├ù should fail registration with existing email (2 ms)
      ├ù should validate phone number format (2 ms)
    User Sign In
      ΓêÜ should successfully sign in with email and password (1 ms)
      ├ù should fail sign in with incorrect password (3 ms)
      ├ù should fail sign in with non-existent user (2 ms)
      ΓêÜ should handle sign in with unverified email (1 ms)
    Two-Factor Authentication
      ├ù should send 2FA code via SMS
      ├ù should verify 2FA code successfully
      ├ù should fail 2FA verification with invalid code
      ├ù should fail 2FA verification with expired code (1 ms)
      ├ù should rate limit 2FA code requests (1 ms)
    Password Reset
      ├ù should send password reset email (1 ms)
      ├ù should fail password reset for non-existent email (1 ms)
      ├ù should reset password with valid token
      ├ù should fail password reset with invalid token (2 ms)
    Session Management
      ├ù should maintain session with valid token
      ├ù should invalidate expired token
      ├ù should refresh token before expiry
      ├ù should successfully sign out user (1 ms)
    Biometric Authentication
      ├ù should enable biometric authentication (1 ms)
      ├ù should authenticate with biometrics
      ├ù should disable biometric authentication
    Account Security
      ├ù should detect and prevent brute force attacks (1 ms)
      ΓêÜ should log security events (1 ms)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should fail registration with weak password

    expect(received).rejects.toThrow(expected)

    Expected substring: "Password must be at least 8 characters"
    Received message:   "Password must be at least 6 characters"

          63 |     // Validate password
          64 |     if (!this.validatePassword(userData.password)) {
        > 65 |       throw new Error('Password must be at least 6 characters');
             |             ^
          66 |     }
          67 |
          68 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/register`, {

      at AuthService.<anonymous> (src/services/authService.ts:65:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as register] (src/services/authService.ts:57:17)
      at Object.register (tests/__tests__/auth.test.ts:58:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:58:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should fail registration with existing email

    expect(received).rejects.toThrow(expected)

    Expected substring: "Email already in use"
    Received message:   "Registration failed"

          76 |     if (!response.ok) {
          77 |       const error = await response.json();
        > 78 |       throw new Error(error.message || 'Registration failed');
             |             ^
          79 |     }
          80 |
          81 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:78:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:71:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should validate phone number format

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid phone number"
    Received message:   "Registration failed"

          76 |     if (!response.ok) {
          77 |       const error = await response.json();
        > 78 |       throw new Error(error.message || 'Registration failed');
             |             ^
          79 |     }
          80 |
          81 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:78:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:81:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Sign In ΓÇ║ should fail sign in with incorrect password

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:113:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Sign In ΓÇ║ should fail sign in with non-existent user

    expect(received).rejects.toThrow(expected)

    Expected substring: "User not found"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:126:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should send 2FA code via SMS

    TypeError: authService.send2FACode is not a function

      149 |       );
      150 |
    > 151 |       const result = await authService.send2FACode('+97412345678');
          |                                        ^
      152 |
      153 |       expect(result.success).toBe(true);
      154 |       expect(result.codeSent).toBe(true);

      at Object.send2FACode (tests/__tests__/auth.test.ts:151:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should verify 2FA code successfully

    TypeError: authService.verify2FACode is not a function

      160 |       );
      161 |
    > 162 |       const result = await authService.verify2FACode('123456');
          |                                        ^
      163 |
      164 |       expect(result.verified).toBe(true);
      165 |       expect(result.token).toBe('test-2fa-token');

      at Object.verify2FACode (tests/__tests__/auth.test.ts:162:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should fail 2FA verification with invalid code

    TypeError: authService.verify2FACode is not a function

      171 |       );
      172 |
    > 173 |       await expect(authService.verify2FACode('000000')).rejects.toThrow('Invalid verification code');
          |                                ^
      174 |     });
      175 |
      176 |     test('should fail 2FA verification with expired code', async () => {

      at Object.verify2FACode (tests/__tests__/auth.test.ts:173:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should fail 2FA verification with expired code

    TypeError: authService.verify2FACode is not a function

      179 |       );
      180 |
    > 181 |       await expect(authService.verify2FACode('123456')).rejects.toThrow('Verification code expired');
          |                                ^
      182 |     });
      183 |
      184 |     test('should rate limit 2FA code requests', async () => {

      at Object.verify2FACode (tests/__tests__/auth.test.ts:181:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should rate limit 2FA code requests

    TypeError: authService.send2FACode is not a function

      187 |       );
      188 |
    > 189 |       await expect(authService.send2FACode('+97412345678')).rejects.toThrow('Too many requests');
          |                                ^
      190 |     });
      191 |   });
      192 |

      at Object.send2FACode (tests/__tests__/auth.test.ts:189:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should send password reset email

    TypeError: authService.sendPasswordResetEmail is not a function

      197 |       );
      198 |
    > 199 |       const result = await authService.sendPasswordResetEmail('test@guild.com');
          |                                        ^
      200 |
      201 |       expect(result.success).toBe(true);
      202 |       expect(result.emailSent).toBe(true);

      at Object.sendPasswordResetEmail (tests/__tests__/auth.test.ts:199:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should fail password reset for non-existent email

    TypeError: authService.sendPasswordResetEmail is not a function

      208 |       );
      209 |
    > 210 |       await expect(authService.sendPasswordResetEmail('nonexistent@guild.com')).rejects.toThrow('User not 
found');
          |                                ^
      211 |     });
      212 |
      213 |     test('should reset password with valid token', async () => {

      at Object.sendPasswordResetEmail (tests/__tests__/auth.test.ts:210:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should reset password with valid token

    Invalid email format

      129 |   async resetPassword(email: string): Promise<void> {
      130 |     if (!this.validateEmail(email)) {
    > 131 |       throw new Error('Invalid email format');
          |             ^
      132 |     }
      133 |
      134 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/reset-password`, {

      at AuthService.<anonymous> (src/services/authService.ts:131:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as resetPassword] (src/services/authService.ts:129:22)
      at Object.resetPassword (tests/__tests__/auth.test.ts:218:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should fail password reset with invalid token

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid reset token"
    Received message:   "Invalid email format"

          129 |   async resetPassword(email: string): Promise<void> {
          130 |     if (!this.validateEmail(email)) {
        > 131 |       throw new Error('Invalid email format');
              |             ^
          132 |     }
          133 |
          134 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/reset-password`, {

      at AuthService.<anonymous> (src/services/authService.ts:131:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as resetPassword] (src/services/authService.ts:129:22)
      at Object.resetPassword (tests/__tests__/auth.test.ts:228:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:228:93)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should maintain session with valid token

    TypeError: authService.validateSession is not a function

      238 |       );
      239 |
    > 240 |       const result = await authService.validateSession('valid-token-123');
          |                                        ^
      241 |
      242 |       expect(result.valid).toBe(true);
      243 |       expect(result.user).toBeDefined();

      at Object.validateSession (tests/__tests__/auth.test.ts:240:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should invalidate expired token

    TypeError: authService.validateSession is not a function

      249 |       );
      250 |
    > 251 |       await expect(authService.validateSession('expired-token')).rejects.toThrow('Token expired');
          |                                ^
      252 |     });
      253 |
      254 |     test('should refresh token before expiry', async () => {

      at Object.validateSession (tests/__tests__/auth.test.ts:251:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should refresh token before expiry

    TypeError: authService.refreshToken is not a function

      257 |       );
      258 |
    > 259 |       const result = await authService.refreshToken('old-token-123');
          |                                        ^
      260 |
      261 |       expect(result.token).toBe('new-token-123');
      262 |       expect(result.expiresIn).toBe(3600);

      at Object.refreshToken (tests/__tests__/auth.test.ts:259:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should successfully sign out user

    TypeError: Cannot read properties of undefined (reading 'success')

      270 |       const result = await authService.signOut();
      271 |
    > 272 |       expect(result.success).toBe(true);
          |                     ^
      273 |     });
      274 |   });
      275 |

      at Object.success (tests/__tests__/auth.test.ts:272:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should enable biometric authentication

    TypeError: authService.enableBiometric is not a function

      276 |   describe('Biometric Authentication', () => {
      277 |     test('should enable biometric authentication', async () => {
    > 278 |       const result = await authService.enableBiometric();
          |                                        ^
      279 |
      280 |       expect(result.enabled).toBe(true);
      281 |     });

      at Object.enableBiometric (tests/__tests__/auth.test.ts:278:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should authenticate with biometrics

    TypeError: authService.authenticateWithBiometric is not a function

      282 |
      283 |     test('should authenticate with biometrics', async () => {
    > 284 |       const result = await authService.authenticateWithBiometric();
          |                                        ^
      285 |
      286 |       expect(result.success).toBe(true);
      287 |     });

      at Object.authenticateWithBiometric (tests/__tests__/auth.test.ts:284:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should disable biometric authentication

    TypeError: authService.disableBiometric is not a function

      288 |
      289 |     test('should disable biometric authentication', async () => {
    > 290 |       const result = await authService.disableBiometric();
          |                                        ^
      291 |
      292 |       expect(result.disabled).toBe(true);
      293 |     });

      at Object.disableBiometric (tests/__tests__/auth.test.ts:290:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Account Security ΓÇ║ should detect and prevent brute force attacks

    expect(received).rejects.toThrow(expected)

    Expected substring: "Too many failed attempts"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:319:17)
          at Generator.throw (<anonymous>)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _throw (node_modules/@babel/runtime/helpers/asyncToGenerator.js:20:9)

PASS src/app/(modals)/__tests__/wallet.test.tsx
  WalletModal
    ΓêÜ should render wallet modal components (600 ms)
    ΓêÜ should display correct balance (30 ms)
    ΓêÜ should handle deposit button press (11 ms)
    ΓêÜ should handle withdraw button press (8 ms)
    ΓêÜ should handle escrow button press (9 ms)
    ΓêÜ should switch between transactions and recipients (29 ms)
    ΓêÜ should render QR buttons (8 ms)

PASS src/app/(auth)/__tests__/sign-in.test.tsx
  SignInScreen
    ΓêÜ should render sign in form (671 ms)
    ΓêÜ should handle email input (9 ms)
    ΓêÜ should handle password input (11 ms)
    ΓêÜ should handle sign in button press (3 ms)

FAIL tests/__tests__/jobs.test.ts
  Job Lifecycle Tests
    Job Creation
      ├ù should successfully create a new job (11 ms)
      ├ù should validate required fields (12 ms)
      ├ù should validate budget is positive (5 ms)
      ├ù should set expiry date to 30 days (3 ms)
      ├ù should create job with location coordinates (3 ms)
    Job Discovery
      ├ù should fetch open jobs (17 ms)
      ├ù should filter jobs by category (1 ms)
      ├ù should filter jobs by location radius (1 ms)
      ├ù should search jobs by keywords (1 ms)
      ├ù should filter by budget range (1 ms)
    Job Application & Acceptance
      ├ù should successfully accept a job
      ├ù should fail to accept already accepted job (1 ms)
      ├ù should fail to accept expired job (1 ms)
      ├ù should create contract on job acceptance (1 ms)
      ├ù should notify job poster when accepted (1 ms)
    Job Completion & Payment
      ├ù should mark job as completed (1 ms)
      ├ù should require evidence for job completion
      ├ù should release payment on job completion
      ├ù should auto-release payment after 7-14 days (1 ms)
      ├ù should handle disputed job completion (1 ms)
    Job Cancellation
      ├ù should cancel job before acceptance (1 ms)
      ├ù should refund payment on cancellation after acceptance (1 ms)
      ├ù should apply cancellation fee for late cancellation (2 ms)
    Job Expiry
      ├ù should auto-expire jobs after 30 days
      ├ù should refund payment on job expiry
    Job Reviews & Ratings
      ├ù should allow poster to rate worker
      ├ù should allow worker to rate poster
      ├ù should prevent duplicate reviews (1 ms)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should successfully create a new job

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:39:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should validate required fields

    expect(received).rejects.toThrow(expected)

    Expected substring: "Title is required"
    Received message:   "A dynamic import callback was invoked without --experimental-vm-modules"

          117 |       
          118 |       // Check authentication first
        > 119 |       const { auth } = await import('../config/firebase');
              |       ^
          120 |       const currentUser = auth.currentUser;
          121 |       
          122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:52:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/jobs.test.ts:52:66)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should validate budget is positive

    expect(received).rejects.toThrow(expected)

    Expected substring: "Budget must be positive"
    Received message:   "A dynamic import callback was invoked without --experimental-vm-modules"

          117 |       
          118 |       // Check authentication first
        > 119 |       const { auth } = await import('../config/firebase');
              |       ^
          120 |       const currentUser = auth.currentUser;
          121 |       
          122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:58:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/jobs.test.ts:58:59)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should set expiry date to 30 days

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:72:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should create job with location coordinates

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:92:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should fetch open jobs

    Failed to get open jobs

      484 |     } catch (error) {
      485 |       console.error('Error getting open jobs:', error);
    > 486 |       throw new Error('Failed to get open jobs');
          |             ^
      487 |     }
      488 |   }
      489 |

      at JobService.<anonymous> (src/services/jobService.ts:486:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter jobs by category

    TypeError: _jobService.jobService.getJobsByCategory is not a function

      125 |       );
      126 |
    > 127 |       const result = await jobService.getJobsByCategory('Development');
          |                                       ^
      128 |
      129 |       expect(result.jobs).toHaveLength(2);
      130 |       expect(result.jobs.every(job => job.category === 'Development')).toBe(true);

      at Object.getJobsByCategory (tests/__tests__/jobs.test.ts:127:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter jobs by location radius

    TypeError: _jobService.jobService.getNearbyJobs is not a function

      144 |       );
      145 |
    > 146 |       const result = await jobService.getNearbyJobs({
          |                                       ^
      147 |         latitude: 25.2854,
      148 |         longitude: 51.5310,
      149 |         radius: 5, // km

      at Object.getNearbyJobs (tests/__tests__/jobs.test.ts:146:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should search jobs by keywords

    TypeError: _jobService.jobService.searchJobs is not a function

      164 |       );
      165 |
    > 166 |       const result = await jobService.searchJobs('React');
          |                                       ^
      167 |
      168 |       expect(result.jobs).toHaveLength(2);
      169 |       expect(result.jobs.every(job => job.title.includes('React'))).toBe(true);

      at Object.searchJobs (tests/__tests__/jobs.test.ts:166:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter by budget range

    TypeError: _jobService.jobService.getJobsByBudget is not a function

      180 |       );
      181 |
    > 182 |       const result = await jobService.getJobsByBudget({ min: 500, max: 1000 });
          |                                       ^
      183 |
      184 |       expect(result.jobs).toHaveLength(2);
      185 |       expect(result.jobs.every(job => job.budget >= 500 && job.budget <= 1000)).toBe(true);

      at Object.getJobsByBudget (tests/__tests__/jobs.test.ts:182:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should successfully accept a job

    TypeError: _jobService.jobService.acceptJob is not a function

      195 |       );
      196 |
    > 197 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      198 |
      199 |       expect(result.job.status).toBe('accepted');
      200 |       expect(result.contract).toBeDefined();

      at Object.acceptJob (tests/__tests__/jobs.test.ts:197:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should fail to accept already accepted job

    TypeError: _jobService.jobService.acceptJob is not a function

      206 |       );
      207 |
    > 208 |       await expect(jobService.acceptJob('job-123')).rejects.toThrow('Job already accepted');
          |                               ^
      209 |     });
      210 |
      211 |     test('should fail to accept expired job', async () => {

      at Object.acceptJob (tests/__tests__/jobs.test.ts:208:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should fail to accept expired job

    TypeError: _jobService.jobService.acceptJob is not a function

      214 |       );
      215 |
    > 216 |       await expect(jobService.acceptJob('job-123')).rejects.toThrow('Job has expired');
          |                               ^
      217 |     });
      218 |
      219 |     test('should create contract on job acceptance', async () => {

      at Object.acceptJob (tests/__tests__/jobs.test.ts:216:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should create contract on job acceptance

    TypeError: _jobService.jobService.acceptJob is not a function

      231 |       );
      232 |
    > 233 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      234 |
      235 |       expect(result.contract).toBeDefined();
      236 |       expect(result.contract.status).toBe('active');

      at Object.acceptJob (tests/__tests__/jobs.test.ts:233:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should notify job poster when accepted

    TypeError: _jobService.jobService.acceptJob is not a function

      242 |       );
      243 |
    > 244 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      245 |
      246 |       expect(result.notificationSent).toBe(true);
      247 |     });

      at Object.acceptJob (tests/__tests__/jobs.test.ts:244:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should mark job as completed

    TypeError: _jobService.jobService.completeJob is not a function

      256 |       );
      257 |
    > 258 |       const result = await jobService.completeJob('job-123');
          |                                       ^
      259 |
      260 |       expect(result.job.status).toBe('completed');
      261 |     });

      at Object.completeJob (tests/__tests__/jobs.test.ts:258:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should require evidence for job completion

    TypeError: _jobService.jobService.completeJob is not a function

      267 |
      268 |       await expect(
    > 269 |         jobService.completeJob('job-123', { evidence: [] })
          |                    ^
      270 |       ).rejects.toThrow('Evidence required');
      271 |     });
      272 |

      at Object.completeJob (tests/__tests__/jobs.test.ts:269:20)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should release payment on job completion

    TypeError: _jobService.jobService.completeJob is not a function

      280 |       );
      281 |
    > 282 |       const result = await jobService.completeJob('job-123', {
          |                                       ^
      283 |         evidence: ['evidence-1', 'evidence-2'],
      284 |       });
      285 |

      at Object.completeJob (tests/__tests__/jobs.test.ts:282:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should auto-release payment after 7-14 days

    TypeError: _jobService.jobService.checkAutoRelease is not a function

      302 |       );
      303 |
    > 304 |       const result = await jobService.checkAutoRelease('job-123');
          |                                       ^
      305 |
      306 |       expect(result.autoReleased).toBe(true);
      307 |     });

      at Object.checkAutoRelease (tests/__tests__/jobs.test.ts:304:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should handle disputed job completion

    TypeError: _jobService.jobService.disputeJob is not a function

      318 |       );
      319 |
    > 320 |       const result = await jobService.disputeJob('job-123', {
          |                                       ^
      321 |         reason: 'Work not completed as agreed',
      322 |       });
      323 |

      at Object.disputeJob (tests/__tests__/jobs.test.ts:320:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should cancel job before acceptance

    TypeError: Cannot read properties of undefined (reading 'cancelled')

      335 |       const result = await jobService.cancelJob('job-123');
      336 |
    > 337 |       expect(result.cancelled).toBe(true);
          |                     ^
      338 |       expect(result.refunded).toBe(false);
      339 |     });
      340 |

      at Object.cancelled (tests/__tests__/jobs.test.ts:337:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should refund payment on cancellation after acceptance

    TypeError: Cannot read properties of undefined (reading 'cancelled')

      350 |       const result = await jobService.cancelJob('job-123');
      351 |
    > 352 |       expect(result.cancelled).toBe(true);
          |                     ^
      353 |       expect(result.refunded).toBe(true);
      354 |       expect(result.refundAmount).toBe(500);
      355 |     });

      at Object.cancelled (tests/__tests__/jobs.test.ts:352:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should apply cancellation fee for late cancellation

    TypeError: Cannot read properties of undefined (reading 'cancellationFee')

      366 |       const result = await jobService.cancelJob('job-123');
      367 |
    > 368 |       expect(result.cancellationFee).toBe(50);
          |                     ^
      369 |       expect(result.refundAmount).toBe(450);
      370 |     });
      371 |   });

      at Object.cancellationFee (tests/__tests__/jobs.test.ts:368:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Expiry ΓÇ║ should auto-expire jobs after 30 days

    TypeError: _jobService.jobService.checkExpiredJobs is not a function

      382 |       );
      383 |
    > 384 |       const result = await jobService.checkExpiredJobs();
          |                                       ^
      385 |
      386 |       expect(result.expiredJobs).toBeDefined();
      387 |       expect(result.expiredJobs.some(job => job.status === 'expired')).toBe(true);

      at Object.checkExpiredJobs (tests/__tests__/jobs.test.ts:384:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Expiry ΓÇ║ should refund payment on job expiry

    TypeError: _jobService.jobService.expireJob is not a function

      396 |       );
      397 |
    > 398 |       const result = await jobService.expireJob('job-123');
          |                                       ^
      399 |
      400 |       expect(result.refunded).toBe(true);
      401 |       expect(result.refundAmount).toBe(500);

      at Object.expireJob (tests/__tests__/jobs.test.ts:398:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should allow poster to rate worker

    TypeError: _jobService.jobService.rateWorker is not a function

      416 |       );
      417 |
    > 418 |       const result = await jobService.rateWorker('job-123', {
          |                                       ^
      419 |         rating: 5,
      420 |         comment: 'Excellent work!',
      421 |       });

      at Object.rateWorker (tests/__tests__/jobs.test.ts:418:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should allow worker to rate poster

    TypeError: _jobService.jobService.ratePoster is not a function

      436 |       );
      437 |
    > 438 |       const result = await jobService.ratePoster('job-123', {
          |                                       ^
      439 |         rating: 4,
      440 |         comment: 'Good client',
      441 |       });

      at Object.ratePoster (tests/__tests__/jobs.test.ts:438:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should prevent duplicate reviews

    TypeError: _jobService.jobService.rateWorker is not a function

      450 |
      451 |       await expect(
    > 452 |         jobService.rateWorker('job-123', { rating: 5 })
          |                    ^
      453 |       ).rejects.toThrow('Review already submitted');
      454 |     });
      455 |   });

      at Object.rateWorker (tests/__tests__/jobs.test.ts:452:20)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

PASS src/app/(main)/__tests__/home.test.tsx
  HomeScreen
    ΓêÜ should render home screen components (728 ms)
    ΓêÜ should handle tab navigation (18 ms)
    ΓêÜ should handle guild map button press (4 ms)
    ΓêÜ should default to jobs tab (3 ms)
    ΓêÜ should switch between all tabs (10 ms)

FAIL backend/src/__tests__/middleware/auth.test.ts
  Authentication Middleware
    authenticateToken
      ΓêÜ should reject request with no token (7 ms)
      ├ù should reject request with malformed token (4 ms)
      ├ù should reject request with invalid JWT (1 ms)
      ├ù should reject expired token (1 ms)
      ├ù should reject token with invalid payload (1 ms)
      ├ù should reject when user not found (1 ms)
      ├ù should reject inactive user (1 ms)
      ├ù should authenticate valid user successfully (1 ms)
      ├ù should handle database errors gracefully
      ├ù should verify JWT with correct options (1 ms)
      ├ù should update last login timestamp (16 ms)
    JWT_SECRET validation
      ├ù should exit process if JWT_SECRET is not set (15 ms)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject request with malformed token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "NO_TOKEN",
    -   "error": "Access denied. Authentication required.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      86 |
      87 |       expect(res.status).toHaveBeenCalledWith(401);
    > 88 |       expect(res.json).toHaveBeenCalledWith({
         |                        ^
      89 |         error: 'Access denied. Authentication required.',
      90 |         code: 'NO_TOKEN'
      91 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:88:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject request with invalid JWT

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "MALFORMED_TOKEN",
    -   "error": "Malformed token.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      105 |
      106 |       expect(res.status).toHaveBeenCalledWith(401);
    > 107 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      108 |         error: 'Malformed token.',
      109 |         code: 'MALFORMED_TOKEN'
      110 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:107:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject expired token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "TOKEN_EXPIRED",
    -   "error": "Token has expired.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      128 |
      129 |       expect(res.status).toHaveBeenCalledWith(401);
    > 130 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      131 |         error: 'Token has expired.',
      132 |         code: 'TOKEN_EXPIRED'
      133 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:130:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject token with invalid payload

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "INVALID_PAYLOAD",
    -   "error": "Invalid token format.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      143 |
      144 |       expect(res.status).toHaveBeenCalledWith(401);
    > 145 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      146 |         error: 'Invalid token format.',
      147 |         code: 'INVALID_PAYLOAD'
      148 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:145:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "USER_NOT_FOUND",
    -   "error": "User not found.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      159 |
      160 |       expect(res.status).toHaveBeenCalledWith(401);
    > 161 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      162 |         error: 'User not found.',
      163 |         code: 'USER_NOT_FOUND'
      164 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:161:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject inactive user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "ACCOUNT_INACTIVE",
    -   "error": "Account is inactive.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      182 |
      183 |       expect(res.status).toHaveBeenCalledWith(401);
    > 184 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      185 |         error: 'Account is inactive.',
      186 |         code: 'ACCOUNT_INACTIVE'
      187 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:184:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should authenticate valid user successfully

    expect(received).toEqual(expected) // deep equality

    Expected: {"currentRank": "G", "email": "test@example.com", "id": "user-123", "isActive": true, "isVerified": 
true, "lastLoginAt": 2025-10-13T19:00:35.975Z}
    Received: undefined

      207 |       await authenticateToken(req, res as Response, mockNext);
      208 |
    > 209 |       expect(req.user).toEqual(mockUser);
          |                        ^
      210 |       expect(mockNext).toHaveBeenCalled();
      211 |       expect(res.status).not.toHaveBeenCalled();
      212 |       expect(mockLogger.debug).toHaveBeenCalledWith(

      at Object.toEqual (backend/src/__tests__/middleware/auth.test.ts:209:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should handle database errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 401

    Number of calls: 1

      225 |       await authenticateToken(req as AuthenticatedRequest, res as Response, mockNext);
      226 |
    > 227 |       expect(res.status).toHaveBeenCalledWith(500);
          |                          ^
      228 |       expect(res.json).toHaveBeenCalledWith({
      229 |         error: 'Authentication service unavailable.',
      230 |         code: 'AUTH_SERVICE_ERROR'

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:227:26)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should verify JWT with correct options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-jwt", "test-secret", {"algorithms": ["HS256"], "audience": "test-audience", "issuer": 
"test-issuer"}

    Number of calls: 0

      252 |       await authenticateToken(req as AuthenticatedRequest, res as Response, mockNext);
      253 |
    > 254 |       expect(mockJwt.verify).toHaveBeenCalledWith('valid-jwt', 'test-secret', {
          |                              ^
      255 |         algorithms: ['HS256'],
      256 |         issuer: 'test-issuer',
      257 |         audience: 'test-audience'

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:254:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should update last login timestamp

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"lastLoginAt": Any<Date>}, "where": {"id": "user-123"}}

    Number of calls: 0

      280 |       await new Promise(resolve => setTimeout(resolve, 10));
      281 |
    > 282 |       expect(mockPrisma.user.update).toHaveBeenCalledWith({
          |                                      ^
      283 |         where: { id: 'user-123' },
      284 |         data: { lastLoginAt: expect.any(Date) }
      285 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:282:38)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ JWT_SECRET validation ΓÇ║ should exit process if JWT_SECRET is not set

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 1

    Number of calls: 0

      296 |       jest.resetModules();
      297 |       
    > 298 |       expect(process.exit).toHaveBeenCalledWith(1);
          |                            ^
      299 |       
      300 |       // Restore
      301 |       process.exit = originalExit;

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:298:28)

PASS src/services/__tests__/apiGateway.test.ts
  ApiGateway Service
    HTTP Methods
      ΓêÜ should make GET requests (112 ms)
      ΓêÜ should make POST requests (110 ms)
      ΓêÜ should make PUT requests (109 ms)
      ΓêÜ should make DELETE requests (111 ms)
    Authentication
      ΓêÜ should handle successful login (111 ms)
      ΓêÜ should handle failed login (116 ms)
      ΓêÜ should set auth token
      ΓêÜ should clear auth token
    API Endpoints
      ΓêÜ should fetch user profile (135 ms)
      ΓêÜ should fetch jobs (105 ms)
      ΓêÜ should handle health check (110 ms)
    Error Handling
      ΓêÜ should handle network errors gracefully
      ΓêÜ should handle timeout scenarios
    Configuration
      ΓêÜ should initialize with default config (1 ms)
      ΓêÜ should initialize with custom config

  console.log
    [2025-10-13T19:00:36.199Z] [WARN] API request retry {
      requestId: 'req_1760382035190_ozr8lz4ka',
      attempt: 1,
      maxRetries: 3,
      error: 'Rate limit exceeded. Try again in 60 seconds'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

info: ≡ƒÆ░ Using Guild Coin system (PSP disabled for beta) {"service":"guild-backend","timestamp":"2025-10-13T19:00:36.265Z"}
PASS backend/src/services/__tests__/JobService.test.ts
  JobService
    createJob
      ΓêÜ should create a job successfully (5 ms)
      ΓêÜ should validate required fields (6 ms)
    searchJobs
      ΓêÜ should search jobs with filters (1 ms)
    getJobById
      ΓêÜ should retrieve job by ID
      ΓêÜ should throw error for non-existent job (1 ms)

FAIL backend/src/__tests__/integration/GIDSystem.integration.test.ts
  GID System Integration Tests
    Complete User Registration Flow
      ├ù should create GID during user registration (5 ms)
      ├ù should prevent duplicate GID creation
    GID Data Linking & Retrieval
      ├ù should link all user data to GID (1 ms)
      ├ù should retrieve complete user data by GID (3 ms)
    Admin GID Operations
      ΓêÜ should allow admin to search users by GID
      ΓêÜ should allow admin to deactivate user GID (2 ms)
    Ranking System Integration
      ├ù should update user rank through GID (4 ms)
      ΓêÜ should track rank progression data (1 ms)
    Guild Affiliation Management
      ├ù should manage guild memberships through GID
    Performance & Scalability
      ├ù should handle bulk GID operations efficiently (6 ms)
      ├ù should maintain data consistency across operations (1 ms)
    Error Handling & Edge Cases
      ΓêÜ should handle database failures gracefully (1 ms)
      ├ù should validate user data before GID creation
    Privacy & Security
      ΓêÜ should enforce access level restrictions
      ├ù should maintain audit trail for all GID operations
    Integration with Existing Systems
      ├ù should integrate with user registration flow
      ΓêÜ should support user lookup by GID for admin functions

  ΓùÅ GID System Integration Tests ΓÇ║ Complete User Registration Flow ΓÇ║ should create GID during user registration

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Complete User Registration Flow ΓÇ║ should prevent duplicate GID creation

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ GID Data Linking & Retrieval ΓÇ║ should link all user data to GID

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ GID Data Linking & Retrieval ΓÇ║ should retrieve complete user data by GID

    expect(received).toBe(expected) // Object.is equality

    Expected: "Retrieval Test User"
    Received: undefined

      136 |       const container = await gidService.getGIDContainer(gid);
      137 |
    > 138 |       expect(container?.personalInfo.name).toBe('Retrieval Test User');
          |                                            ^
      139 |       expect(container?.platformData.currentRank).toBe('F');
      140 |       expect(container?.platformData.activityHistory.jobsCompleted).toBe(10);
      141 |     });

      at Object.toBe (backend/src/__tests__/integration/GIDSystem.integration.test.ts:138:44)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Ranking System Integration ΓÇ║ should update user rank through GID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    +   "lastUpdated": 2025-10-13T19:00:36.290Z,
        "platformData.currentRank": "S",
    -   "platformData.lastUpdated": Any<Date>,
    +   "platformData.lastUpdated": 2025-10-13T19:00:36.290Z,
      },

    Number of calls: 1

      180 |       await gidService.updateUserRank(gid, 'S');
      181 |
    > 182 |       expect(mockDb.collection().doc().update).toHaveBeenCalledWith({
          |                                                ^
      183 |         'platformData.currentRank': 'S',
      184 |         'platformData.lastUpdated': expect.any(Date)
      185 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/integration/GIDSystem.integration.test.ts:182:48)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Guild Affiliation Management ΓÇ║ should manage guild memberships through GID

    GID container not found

      372 |       const container = await this.getGIDContainer(gid);
      373 |       if (!container) {
    > 374 |         throw new Error('GID container not found');
          |               ^
      375 |       }
      376 |
      377 |       const guilds = container.platformData.guilds;

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:374:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Performance & Scalability ΓÇ║ should handle bulk GID operations efficiently

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Performance & Scalability ΓÇ║ should maintain data consistency across operations

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Error Handling & Edge Cases ΓÇ║ should validate user data before GID creation

    GID_GENERATION_FAILED

      116 |     } catch (error) {
      117 |       logger.error('Failed to generate GID:', error);
    > 118 |       throw new Error('GID_GENERATION_FAILED');
          |             ^
      119 |     }
      120 |   }
      121 |

      at GIDService.generateGID (backend/src/services/firebase/GIDService.ts:118:13)
      at Object.generateGID (backend/src/__tests__/integration/GIDSystem.integration.test.ts:312:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ GID System Integration Tests ΓÇ║ Privacy & Security ΓÇ║ should maintain audit trail for all GID operations

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Integration with Existing Systems ΓÇ║ should integrate with user registration 
flow

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

FAIL backend/src/services/firebase/__tests__/GIDService.test.ts
  GID Service - Comprehensive Testing
    GID Generation
      ΓêÜ should generate unique GIDs for different users (5 ms)
      ΓêÜ should generate deterministic GIDs for same user data (1 ms)
      ΓêÜ should handle different user types correctly
    GID Container Creation
      ├ù should create complete GID container with all data (1 ms)
      ΓêÜ should handle GID collisions gracefully (1 ms)
    GID Data Retrieval
      ΓêÜ should retrieve GID data from cache on second call (1 ms)
      ΓêÜ should return null for non-existent GID (1 ms)
    GID Container Updates
      ΓêÜ should update GID container data correctly (1 ms)
    User GID Lookup
      ΓêÜ should find user GID by user ID
      ΓêÜ should return null for user without GID
    GID Deactivation
      ΓêÜ should deactivate GID and clear cache
    Guild Affiliation Management
      ΓêÜ should add guild affiliation correctly
    Ranking System Integration
      ├ù should update user rank correctly (5 ms)
      ΓêÜ should validate rank values (1 ms)
    Performance & Scalability
      ΓêÜ should handle high-volume GID generation (46 ms)
      ├ù should maintain cache efficiency
    Error Handling & Edge Cases
      ΓêÜ should handle database errors gracefully
      ├ù should handle invalid user data
    Security & Privacy
      ΓêÜ should not expose sensitive data in GID
      ΓêÜ should maintain data privacy in public access (1 ms)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ GID Container Creation ΓÇ║ should create complete GID container with all 
data

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Ranking System Integration ΓÇ║ should update user rank correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    +   "lastUpdated": 2025-10-13T19:00:36.291Z,
        "platformData.currentRank": "F",
    -   "platformData.lastUpdated": Any<Date>,
    +   "platformData.lastUpdated": 2025-10-13T19:00:36.291Z,
      },

    Number of calls: 1

      265 |       await gidService.updateUserRank(gid, newRank);
      266 |
    > 267 |       expect(mockDb.collection().doc().update).toHaveBeenCalledWith({
          |                                                ^
      268 |         'platformData.currentRank': newRank,
      269 |         'platformData.lastUpdated': expect.any(Date)
      270 |       });

      at Object.toHaveBeenCalledWith (backend/src/services/firebase/__tests__/GIDService.test.ts:267:48)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Performance & Scalability ΓÇ║ should maintain cache efficiency

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 2

      316 |       // Second call - cache
      317 |       await gidService.getGIDData(gid);
    > 318 |       expect(mockDb.collection().doc().get).toHaveBeenCalledTimes(1); // Still 1, from cache
          |                                             ^
      319 |     });
      320 |   });
      321 |

      at Object.toHaveBeenCalledTimes (backend/src/services/firebase/__tests__/GIDService.test.ts:318:45)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Error Handling & Edge Cases ΓÇ║ should handle invalid user data

    GID_GENERATION_FAILED

      116 |     } catch (error) {
      117 |       logger.error('Failed to generate GID:', error);
    > 118 |       throw new Error('GID_GENERATION_FAILED');
          |             ^
      119 |     }
      120 |   }
      121 |

      at GIDService.generateGID (backend/src/services/firebase/GIDService.ts:118:13)
      at Object.generateGID (backend/src/services/firebase/__tests__/GIDService.test.ts:340:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  console.log
    [2025-10-13T19:00:38.228Z] [WARN] API request retry {
      requestId: 'req_1760382035190_ozr8lz4ka',
      attempt: 2,
      maxRetries: 3,
      error: 'Rate limit exceeded. Try again in 60 seconds'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

  console.log
    [2025-10-13T19:00:42.239Z] [WARN] API request retry {
      requestId: 'req_1760382035190_ozr8lz4ka',
      attempt: 3,
      maxRetries: 3,
      error: 'Rate limit exceeded. Try again in 60 seconds'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

  console.log
    [2025-10-13T19:00:42.242Z] [ERROR] API request failed {
      requestId: 'req_1760382035190_ozr8lz4ka',
      method: 'GET',
      endpoint: '/test',
      duration: 7052,
      error: 'Rate limit exceeded. Try again in 60 seconds',
      status: 'error'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Generator.throw (<anonymous>)

  console.log
    [2025-10-13T19:00:43.264Z] [WARN] API request retry {
      requestId: 'req_1760382042250_8eqpr0qe2',
      attempt: 1,
      maxRetries: 3,
      error: 'Network request failed'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

  console.log
    [2025-10-13T19:00:45.267Z] [WARN] API request retry {
      requestId: 'req_1760382042250_8eqpr0qe2',
      attempt: 2,
      maxRetries: 3,
      error: 'Network request failed'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

  console.log
    [2025-10-13T19:00:49.272Z] [WARN] API request retry {
      requestId: 'req_1760382042250_8eqpr0qe2',
      attempt: 3,
      maxRetries: 3,
      error: 'Network request failed'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at _loop.next (<anonymous>)

  console.log
    [2025-10-13T19:00:49.276Z] [ERROR] API request failed {
      requestId: 'req_1760382042250_8eqpr0qe2',
      method: 'GET',
      endpoint: '/test',
      duration: 7026,
      error: 'Network request failed',
      status: 'error'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Generator.throw (<anonymous>)

  console.log
    [2025-10-13T19:00:49.281Z] [INFO] API request completed {
      requestId: 'req_1760382049280_61w9fisy1',
      method: 'GET',
      endpoint: '/test/0',
      duration: 1,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.281Z] [INFO] API request completed {
      requestId: 'req_1760382049280_cb55lzii1',
      method: 'GET',
      endpoint: '/test/1',
      duration: 1,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.282Z] [INFO] API request completed {
      requestId: 'req_1760382049280_exuhsy4he',
      method: 'GET',
      endpoint: '/test/2',
      duration: 2,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.283Z] [INFO] API request completed {
      requestId: 'req_1760382049280_naf2nqh8u',
      method: 'GET',
      endpoint: '/test/3',
      duration: 3,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.284Z] [INFO] API request completed {
      requestId: 'req_1760382049280_hvih6gv19',
      method: 'GET',
      endpoint: '/test/4',
      duration: 4,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.284Z] [INFO] API request completed {
      requestId: 'req_1760382049280_8bepfhjlv',
      method: 'GET',
      endpoint: '/test/5',
      duration: 4,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.284Z] [INFO] API request completed {
      requestId: 'req_1760382049280_xpn4qzpev',
      method: 'GET',
      endpoint: '/test/6',
      duration: 4,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.285Z] [INFO] API request completed {
      requestId: 'req_1760382049280_inctehurj',
      method: 'GET',
      endpoint: '/test/7',
      duration: 5,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.285Z] [INFO] API request completed {
      requestId: 'req_1760382049280_76o1dcoli',
      method: 'GET',
      endpoint: '/test/8',
      duration: 5,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.285Z] [INFO] API request completed {
      requestId: 'req_1760382049280_b2ve8jq4b',
      method: 'GET',
      endpoint: '/test/9',
      duration: 5,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

  console.log
    [2025-10-13T19:00:49.287Z] [DEBUG] Returning cached request { requestKey: 'GET_/test-endpoint_' }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Array.from (<anonymous>)

  console.log
    [2025-10-13T19:00:49.288Z] [DEBUG] Returning cached request { requestKey: 'GET_/test-endpoint_' }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Array.from (<anonymous>)

  console.log
    [2025-10-13T19:00:49.289Z] [DEBUG] Returning cached request { requestKey: 'GET_/test-endpoint_' }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Array.from (<anonymous>)

  console.log
    [2025-10-13T19:00:49.290Z] [DEBUG] Returning cached request { requestKey: 'GET_/test-endpoint_' }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)
          at Array.from (<anonymous>)

  console.log
    [2025-10-13T19:00:49.291Z] [INFO] API request completed {
      requestId: 'req_1760382049287_8t90dwvom',
      method: 'GET',
      endpoint: '/test-endpoint',
      duration: 4,
      status: 'success'
    }

      at Logger.apply [as formatMessage] (src/utils/logger.ts:37:18)

FAIL src/__tests__/integration/systemIntegration.test.ts (16.101 s)
  System Integration Tests
    Authentication Flow Integration
      ΓêÜ should handle complete authentication flow (9 ms)
      ΓêÜ should handle authentication security events (2 ms)
    API Gateway Integration
      ├ù should handle secure API requests with validation (32 ms)
      ΓêÜ should handle rate limiting (7057 ms)
    Data Protection Integration
      ΓêÜ should handle consent management
      ΓêÜ should handle data export requests (1 ms)
      ΓêÜ should handle data deletion requests
    Security Monitoring Integration
      ΓêÜ should detect and handle security threats (1 ms)
      ΓêÜ should handle brute force detection
    Cross-System Data Flow
      ├ù should maintain data consistency across systems (1 ms)
    Error Handling Integration
      ΓêÜ should handle network errors gracefully (7027 ms)
      ├ù should handle authentication errors (1 ms)
      ΓêÜ should handle validation errors (2 ms)
    Performance Integration
      ΓêÜ should handle concurrent requests efficiently (6 ms)
      ΓêÜ should handle request deduplication (4 ms)
    Compliance Integration
      ΓêÜ should ensure GDPR compliance in data operations
      ΓêÜ should handle data retention policies
  End-to-End User Journeys
    ├ù should handle complete user registration and job posting flow (1 ms)

  ΓùÅ System Integration Tests ΓÇ║ API Gateway Integration ΓÇ║ should handle secure API requests with validation

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      130 |     it('should handle secure API requests with validation', async () => {
      131 |       // Mock authentication token
    > 132 |       jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                  ^
      133 |
      134 |       // Test API request with input validation
      135 |       const jobData = {

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:132:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ System Integration Tests ΓÇ║ Cross-System Data Flow ΓÇ║ should maintain data consistency across systems

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      282 |     it('should maintain data consistency across systems', async () => {
      283 |       // Mock authentication token
    > 284 |       jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                  ^
      285 |
      286 |       const userId = 'test-user-123';
      287 |       const jobData = {

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:284:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ System Integration Tests ΓÇ║ Error Handling Integration ΓÇ║ should handle authentication errors

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      345 |     it('should handle authentication errors', async () => {
      346 |       // Mock no auth token available
    > 347 |       jest.spyOn(require('../services/secureStorage').secureStorage, 'getItem').mockResolvedValue(null);
          |                  ^
      348 |
      349 |       const response = await api.get('/protected-resource', { requireAuth: true });
      350 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:347:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ End-to-End User Journeys ΓÇ║ should handle complete user registration and job posting flow

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      509 |     // 3. User posts a job
      510 |     // Mock authentication token for API call
    > 511 |     jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                ^
      512 |
      513 |     const jobData = {
      514 |       title: 'Mobile App Developer',

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:511:16)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due 
to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure 
that .unref() was called on them.
Summary of all failing tests
FAIL tests/__tests__/payments.test.ts
  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should fail payment if insufficient balance

    expect(received).rejects.toThrow(expected)

    Expected substring: "Insufficient balance"
    Received message:   "Failed to process job payment"

          171 |
          172 |     if (!response.ok) {
        > 173 |       throw new Error('Failed to process job payment');
              |             ^
          174 |     }
          175 |
          176 |     return response.json();

      at PaymentService.<anonymous> (src/services/paymentService.ts:173:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/payments.test.ts:100:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should hold payment until job completion

    TypeError: paymentService.holdPayment is not a function

      110 |       );
      111 |
    > 112 |       const result = await paymentService.holdPayment({
          |                                           ^
      113 |         jobId: 'job-123',
      114 |         amount: 50,
      115 |       });

      at Object.holdPayment (tests/__tests__/payments.test.ts:112:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should release payment to worker on job completion

    TypeError: paymentService.releasePayment is not a function

      128 |       );
      129 |
    > 130 |       const result = await paymentService.releasePayment('job-123');
          |                                           ^
      131 |
      132 |       expect(result.released).toBe(true);
      133 |       expect(result.amount).toBe(50);

      at Object.releasePayment (tests/__tests__/payments.test.ts:130:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Job Payments ΓÇ║ should refund payment on job cancellation

    TypeError: paymentService.refundPayment is not a function

      143 |       );
      144 |
    > 145 |       const result = await paymentService.refundPayment('job-123');
          |                                           ^
      146 |
      147 |       expect(result.refunded).toBe(true);
      148 |       expect(result.amount).toBe(50);

      at Object.refundPayment (tests/__tests__/payments.test.ts:145:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Transaction Verification ΓÇ║ should validate transaction integrity

    TypeError: paymentService.verifyTransaction is not a function

      169 |       );
      170 |
    > 171 |       const result = await paymentService.verifyTransaction('txn-123');
          |                                           ^
      172 |
      173 |       expect(result.valid).toBe(true);
      174 |       expect(result.verified).toBe(true);

      at Object.verifyTransaction (tests/__tests__/payments.test.ts:171:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Transaction Verification ΓÇ║ should detect fraudulent transactions

    TypeError: paymentService.processPayment is not a function

      181 |
      182 |       await expect(
    > 183 |         paymentService.processPayment({ amount: 10000 })
          |                        ^
      184 |       ).rejects.toThrow('Transaction flagged as suspicious');
      185 |     });
      186 |   });

      at Object.processPayment (tests/__tests__/payments.test.ts:183:24)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Recovery ΓÇ║ should retry failed payment

    TypeError: paymentService.retryPayment is not a function

      192 |         .mockResolvedValueOnce(mockApiResponse({ success: true }));
      193 |
    > 194 |       const result = await paymentService.retryPayment('txn-123');
          |                                           ^
      195 |
      196 |       expect(result.success).toBe(true);
      197 |     });

      at Object.retryPayment (tests/__tests__/payments.test.ts:194:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Recovery ΓÇ║ should rollback failed transaction

    TypeError: paymentService.rollbackTransaction is not a function

      202 |       );
      203 |
    > 204 |       const result = await paymentService.rollbackTransaction('txn-123');
          |                                           ^
      205 |
      206 |       expect(result.rolledBack).toBe(true);
      207 |       expect(result.refunded).toBe(true);

      at Object.rollbackTransaction (tests/__tests__/payments.test.ts:204:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Analytics ΓÇ║ should calculate total earnings

    TypeError: paymentService.getTotalEarnings is not a function

      218 |       );
      219 |
    > 220 |       const result = await paymentService.getTotalEarnings('user-123');
          |                                           ^
      221 |
      222 |       expect(result.totalEarnings).toBe(500);
      223 |       expect(result.transactionCount).toBe(10);

      at Object.getTotalEarnings (tests/__tests__/payments.test.ts:220:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Payment System Tests (Guild Coins) ΓÇ║ Payment Analytics ΓÇ║ should calculate total spending

    TypeError: paymentService.getTotalSpending is not a function

      232 |       );
      233 |
    > 234 |       const result = await paymentService.getTotalSpending('user-123');
          |                                           ^
      235 |
      236 |       expect(result.totalSpending).toBe(200);
      237 |       expect(result.transactionCount).toBe(4);

      at Object.getTotalSpending (tests/__tests__/payments.test.ts:234:43)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

FAIL tests/__tests__/auth.test.ts
  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should fail registration with weak password

    expect(received).rejects.toThrow(expected)

    Expected substring: "Password must be at least 8 characters"
    Received message:   "Password must be at least 6 characters"

          63 |     // Validate password
          64 |     if (!this.validatePassword(userData.password)) {
        > 65 |       throw new Error('Password must be at least 6 characters');
             |             ^
          66 |     }
          67 |
          68 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/register`, {

      at AuthService.<anonymous> (src/services/authService.ts:65:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as register] (src/services/authService.ts:57:17)
      at Object.register (tests/__tests__/auth.test.ts:58:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:58:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should fail registration with existing email

    expect(received).rejects.toThrow(expected)

    Expected substring: "Email already in use"
    Received message:   "Registration failed"

          76 |     if (!response.ok) {
          77 |       const error = await response.json();
        > 78 |       throw new Error(error.message || 'Registration failed');
             |             ^
          79 |     }
          80 |
          81 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:78:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:71:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Registration ΓÇ║ should validate phone number format

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid phone number"
    Received message:   "Registration failed"

          76 |     if (!response.ok) {
          77 |       const error = await response.json();
        > 78 |       throw new Error(error.message || 'Registration failed');
             |             ^
          79 |     }
          80 |
          81 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:78:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:81:60)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Sign In ΓÇ║ should fail sign in with incorrect password

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid credentials"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:113:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ User Sign In ΓÇ║ should fail sign in with non-existent user

    expect(received).rejects.toThrow(expected)

    Expected substring: "User not found"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:126:17)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should send 2FA code via SMS

    TypeError: authService.send2FACode is not a function

      149 |       );
      150 |
    > 151 |       const result = await authService.send2FACode('+97412345678');
          |                                        ^
      152 |
      153 |       expect(result.success).toBe(true);
      154 |       expect(result.codeSent).toBe(true);

      at Object.send2FACode (tests/__tests__/auth.test.ts:151:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should verify 2FA code successfully

    TypeError: authService.verify2FACode is not a function

      160 |       );
      161 |
    > 162 |       const result = await authService.verify2FACode('123456');
          |                                        ^
      163 |
      164 |       expect(result.verified).toBe(true);
      165 |       expect(result.token).toBe('test-2fa-token');

      at Object.verify2FACode (tests/__tests__/auth.test.ts:162:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should fail 2FA verification with invalid code

    TypeError: authService.verify2FACode is not a function

      171 |       );
      172 |
    > 173 |       await expect(authService.verify2FACode('000000')).rejects.toThrow('Invalid verification code');
          |                                ^
      174 |     });
      175 |
      176 |     test('should fail 2FA verification with expired code', async () => {

      at Object.verify2FACode (tests/__tests__/auth.test.ts:173:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should fail 2FA verification with expired code

    TypeError: authService.verify2FACode is not a function

      179 |       );
      180 |
    > 181 |       await expect(authService.verify2FACode('123456')).rejects.toThrow('Verification code expired');
          |                                ^
      182 |     });
      183 |
      184 |     test('should rate limit 2FA code requests', async () => {

      at Object.verify2FACode (tests/__tests__/auth.test.ts:181:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Two-Factor Authentication ΓÇ║ should rate limit 2FA code requests

    TypeError: authService.send2FACode is not a function

      187 |       );
      188 |
    > 189 |       await expect(authService.send2FACode('+97412345678')).rejects.toThrow('Too many requests');
          |                                ^
      190 |     });
      191 |   });
      192 |

      at Object.send2FACode (tests/__tests__/auth.test.ts:189:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should send password reset email

    TypeError: authService.sendPasswordResetEmail is not a function

      197 |       );
      198 |
    > 199 |       const result = await authService.sendPasswordResetEmail('test@guild.com');
          |                                        ^
      200 |
      201 |       expect(result.success).toBe(true);
      202 |       expect(result.emailSent).toBe(true);

      at Object.sendPasswordResetEmail (tests/__tests__/auth.test.ts:199:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should fail password reset for non-existent email

    TypeError: authService.sendPasswordResetEmail is not a function

      208 |       );
      209 |
    > 210 |       await expect(authService.sendPasswordResetEmail('nonexistent@guild.com')).rejects.toThrow('User not 
found');
          |                                ^
      211 |     });
      212 |
      213 |     test('should reset password with valid token', async () => {

      at Object.sendPasswordResetEmail (tests/__tests__/auth.test.ts:210:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should reset password with valid token

    Invalid email format

      129 |   async resetPassword(email: string): Promise<void> {
      130 |     if (!this.validateEmail(email)) {
    > 131 |       throw new Error('Invalid email format');
          |             ^
      132 |     }
      133 |
      134 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/reset-password`, {

      at AuthService.<anonymous> (src/services/authService.ts:131:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as resetPassword] (src/services/authService.ts:129:22)
      at Object.resetPassword (tests/__tests__/auth.test.ts:218:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Password Reset ΓÇ║ should fail password reset with invalid token

    expect(received).rejects.toThrow(expected)

    Expected substring: "Invalid reset token"
    Received message:   "Invalid email format"

          129 |   async resetPassword(email: string): Promise<void> {
          130 |     if (!this.validateEmail(email)) {
        > 131 |       throw new Error('Invalid email format');
              |             ^
          132 |     }
          133 |
          134 |     const response = await fetch(`${this.apiBaseUrl}/api/v1/auth/reset-password`, {

      at AuthService.<anonymous> (src/services/authService.ts:131:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at AuthService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at AuthService.apply [as resetPassword] (src/services/authService.ts:129:22)
      at Object.resetPassword (tests/__tests__/auth.test.ts:228:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:228:93)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should maintain session with valid token

    TypeError: authService.validateSession is not a function

      238 |       );
      239 |
    > 240 |       const result = await authService.validateSession('valid-token-123');
          |                                        ^
      241 |
      242 |       expect(result.valid).toBe(true);
      243 |       expect(result.user).toBeDefined();

      at Object.validateSession (tests/__tests__/auth.test.ts:240:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should invalidate expired token

    TypeError: authService.validateSession is not a function

      249 |       );
      250 |
    > 251 |       await expect(authService.validateSession('expired-token')).rejects.toThrow('Token expired');
          |                                ^
      252 |     });
      253 |
      254 |     test('should refresh token before expiry', async () => {

      at Object.validateSession (tests/__tests__/auth.test.ts:251:32)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should refresh token before expiry

    TypeError: authService.refreshToken is not a function

      257 |       );
      258 |
    > 259 |       const result = await authService.refreshToken('old-token-123');
          |                                        ^
      260 |
      261 |       expect(result.token).toBe('new-token-123');
      262 |       expect(result.expiresIn).toBe(3600);

      at Object.refreshToken (tests/__tests__/auth.test.ts:259:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Session Management ΓÇ║ should successfully sign out user

    TypeError: Cannot read properties of undefined (reading 'success')

      270 |       const result = await authService.signOut();
      271 |
    > 272 |       expect(result.success).toBe(true);
          |                     ^
      273 |     });
      274 |   });
      275 |

      at Object.success (tests/__tests__/auth.test.ts:272:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should enable biometric authentication

    TypeError: authService.enableBiometric is not a function

      276 |   describe('Biometric Authentication', () => {
      277 |     test('should enable biometric authentication', async () => {
    > 278 |       const result = await authService.enableBiometric();
          |                                        ^
      279 |
      280 |       expect(result.enabled).toBe(true);
      281 |     });

      at Object.enableBiometric (tests/__tests__/auth.test.ts:278:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should authenticate with biometrics

    TypeError: authService.authenticateWithBiometric is not a function

      282 |
      283 |     test('should authenticate with biometrics', async () => {
    > 284 |       const result = await authService.authenticateWithBiometric();
          |                                        ^
      285 |
      286 |       expect(result.success).toBe(true);
      287 |     });

      at Object.authenticateWithBiometric (tests/__tests__/auth.test.ts:284:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Biometric Authentication ΓÇ║ should disable biometric authentication

    TypeError: authService.disableBiometric is not a function

      288 |
      289 |     test('should disable biometric authentication', async () => {
    > 290 |       const result = await authService.disableBiometric();
          |                                        ^
      291 |
      292 |       expect(result.disabled).toBe(true);
      293 |     });

      at Object.disableBiometric (tests/__tests__/auth.test.ts:290:40)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Authentication Flow Tests ΓÇ║ Account Security ΓÇ║ should detect and prevent brute force attacks

    expect(received).rejects.toThrow(expected)

    Expected substring: "Too many failed attempts"
    Received message:   "Sign in failed"

          101 |     if (!response.ok) {
          102 |       const error = await response.json();
        > 103 |       throw new Error(error.message || 'Sign in failed');
              |             ^
          104 |     }
          105 |
          106 |     return response.json();

      at AuthService.<anonymous> (src/services/authService.ts:103:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/auth.test.ts:319:17)
          at Generator.throw (<anonymous>)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _throw (node_modules/@babel/runtime/helpers/asyncToGenerator.js:20:9)

FAIL tests/__tests__/jobs.test.ts
  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should successfully create a new job

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:39:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should validate required fields

    expect(received).rejects.toThrow(expected)

    Expected substring: "Title is required"
    Received message:   "A dynamic import callback was invoked without --experimental-vm-modules"

          117 |       
          118 |       // Check authentication first
        > 119 |       const { auth } = await import('../config/firebase');
              |       ^
          120 |       const currentUser = auth.currentUser;
          121 |       
          122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:52:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/jobs.test.ts:52:66)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should validate budget is positive

    expect(received).rejects.toThrow(expected)

    Expected substring: "Budget must be positive"
    Received message:   "A dynamic import callback was invoked without --experimental-vm-modules"

          117 |       
          118 |       // Check authentication first
        > 119 |       const { auth } = await import('../config/firebase');
              |       ^
          120 |       const currentUser = auth.currentUser;
          121 |       
          122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:58:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.toThrow (tests/__tests__/jobs.test.ts:58:59)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should set expiry date to 30 days

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:72:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Creation ΓÇ║ should create job with location coordinates

    TypeError: A dynamic import callback was invoked without --experimental-vm-modules

      117 |       
      118 |       // Check authentication first
    > 119 |       const { auth } = await import('../config/firebase');
          |       ^
      120 |       const currentUser = auth.currentUser;
      121 |       
      122 |       if (!currentUser) {

      at JobService.<anonymous> (src/services/jobService.ts:119:7)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at JobService.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
      at JobService.apply [as createJob] (src/services/jobService.ts:114:18)
      at Object.createJob (tests/__tests__/jobs.test.ts:92:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should fetch open jobs

    Failed to get open jobs

      484 |     } catch (error) {
      485 |       console.error('Error getting open jobs:', error);
    > 486 |       throw new Error('Failed to get open jobs');
          |             ^
      487 |     }
      488 |   }
      489 |

      at JobService.<anonymous> (src/services/jobService.ts:486:13)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter jobs by category

    TypeError: _jobService.jobService.getJobsByCategory is not a function

      125 |       );
      126 |
    > 127 |       const result = await jobService.getJobsByCategory('Development');
          |                                       ^
      128 |
      129 |       expect(result.jobs).toHaveLength(2);
      130 |       expect(result.jobs.every(job => job.category === 'Development')).toBe(true);

      at Object.getJobsByCategory (tests/__tests__/jobs.test.ts:127:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter jobs by location radius

    TypeError: _jobService.jobService.getNearbyJobs is not a function

      144 |       );
      145 |
    > 146 |       const result = await jobService.getNearbyJobs({
          |                                       ^
      147 |         latitude: 25.2854,
      148 |         longitude: 51.5310,
      149 |         radius: 5, // km

      at Object.getNearbyJobs (tests/__tests__/jobs.test.ts:146:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should search jobs by keywords

    TypeError: _jobService.jobService.searchJobs is not a function

      164 |       );
      165 |
    > 166 |       const result = await jobService.searchJobs('React');
          |                                       ^
      167 |
      168 |       expect(result.jobs).toHaveLength(2);
      169 |       expect(result.jobs.every(job => job.title.includes('React'))).toBe(true);

      at Object.searchJobs (tests/__tests__/jobs.test.ts:166:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Discovery ΓÇ║ should filter by budget range

    TypeError: _jobService.jobService.getJobsByBudget is not a function

      180 |       );
      181 |
    > 182 |       const result = await jobService.getJobsByBudget({ min: 500, max: 1000 });
          |                                       ^
      183 |
      184 |       expect(result.jobs).toHaveLength(2);
      185 |       expect(result.jobs.every(job => job.budget >= 500 && job.budget <= 1000)).toBe(true);

      at Object.getJobsByBudget (tests/__tests__/jobs.test.ts:182:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should successfully accept a job

    TypeError: _jobService.jobService.acceptJob is not a function

      195 |       );
      196 |
    > 197 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      198 |
      199 |       expect(result.job.status).toBe('accepted');
      200 |       expect(result.contract).toBeDefined();

      at Object.acceptJob (tests/__tests__/jobs.test.ts:197:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should fail to accept already accepted job

    TypeError: _jobService.jobService.acceptJob is not a function

      206 |       );
      207 |
    > 208 |       await expect(jobService.acceptJob('job-123')).rejects.toThrow('Job already accepted');
          |                               ^
      209 |     });
      210 |
      211 |     test('should fail to accept expired job', async () => {

      at Object.acceptJob (tests/__tests__/jobs.test.ts:208:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should fail to accept expired job

    TypeError: _jobService.jobService.acceptJob is not a function

      214 |       );
      215 |
    > 216 |       await expect(jobService.acceptJob('job-123')).rejects.toThrow('Job has expired');
          |                               ^
      217 |     });
      218 |
      219 |     test('should create contract on job acceptance', async () => {

      at Object.acceptJob (tests/__tests__/jobs.test.ts:216:31)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should create contract on job acceptance

    TypeError: _jobService.jobService.acceptJob is not a function

      231 |       );
      232 |
    > 233 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      234 |
      235 |       expect(result.contract).toBeDefined();
      236 |       expect(result.contract.status).toBe('active');

      at Object.acceptJob (tests/__tests__/jobs.test.ts:233:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Application & Acceptance ΓÇ║ should notify job poster when accepted

    TypeError: _jobService.jobService.acceptJob is not a function

      242 |       );
      243 |
    > 244 |       const result = await jobService.acceptJob('job-123');
          |                                       ^
      245 |
      246 |       expect(result.notificationSent).toBe(true);
      247 |     });

      at Object.acceptJob (tests/__tests__/jobs.test.ts:244:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should mark job as completed

    TypeError: _jobService.jobService.completeJob is not a function

      256 |       );
      257 |
    > 258 |       const result = await jobService.completeJob('job-123');
          |                                       ^
      259 |
      260 |       expect(result.job.status).toBe('completed');
      261 |     });

      at Object.completeJob (tests/__tests__/jobs.test.ts:258:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should require evidence for job completion

    TypeError: _jobService.jobService.completeJob is not a function

      267 |
      268 |       await expect(
    > 269 |         jobService.completeJob('job-123', { evidence: [] })
          |                    ^
      270 |       ).rejects.toThrow('Evidence required');
      271 |     });
      272 |

      at Object.completeJob (tests/__tests__/jobs.test.ts:269:20)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should release payment on job completion

    TypeError: _jobService.jobService.completeJob is not a function

      280 |       );
      281 |
    > 282 |       const result = await jobService.completeJob('job-123', {
          |                                       ^
      283 |         evidence: ['evidence-1', 'evidence-2'],
      284 |       });
      285 |

      at Object.completeJob (tests/__tests__/jobs.test.ts:282:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should auto-release payment after 7-14 days

    TypeError: _jobService.jobService.checkAutoRelease is not a function

      302 |       );
      303 |
    > 304 |       const result = await jobService.checkAutoRelease('job-123');
          |                                       ^
      305 |
      306 |       expect(result.autoReleased).toBe(true);
      307 |     });

      at Object.checkAutoRelease (tests/__tests__/jobs.test.ts:304:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Completion & Payment ΓÇ║ should handle disputed job completion

    TypeError: _jobService.jobService.disputeJob is not a function

      318 |       );
      319 |
    > 320 |       const result = await jobService.disputeJob('job-123', {
          |                                       ^
      321 |         reason: 'Work not completed as agreed',
      322 |       });
      323 |

      at Object.disputeJob (tests/__tests__/jobs.test.ts:320:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should cancel job before acceptance

    TypeError: Cannot read properties of undefined (reading 'cancelled')

      335 |       const result = await jobService.cancelJob('job-123');
      336 |
    > 337 |       expect(result.cancelled).toBe(true);
          |                     ^
      338 |       expect(result.refunded).toBe(false);
      339 |     });
      340 |

      at Object.cancelled (tests/__tests__/jobs.test.ts:337:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should refund payment on cancellation after acceptance

    TypeError: Cannot read properties of undefined (reading 'cancelled')

      350 |       const result = await jobService.cancelJob('job-123');
      351 |
    > 352 |       expect(result.cancelled).toBe(true);
          |                     ^
      353 |       expect(result.refunded).toBe(true);
      354 |       expect(result.refundAmount).toBe(500);
      355 |     });

      at Object.cancelled (tests/__tests__/jobs.test.ts:352:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Cancellation ΓÇ║ should apply cancellation fee for late cancellation

    TypeError: Cannot read properties of undefined (reading 'cancellationFee')

      366 |       const result = await jobService.cancelJob('job-123');
      367 |
    > 368 |       expect(result.cancellationFee).toBe(50);
          |                     ^
      369 |       expect(result.refundAmount).toBe(450);
      370 |     });
      371 |   });

      at Object.cancellationFee (tests/__tests__/jobs.test.ts:368:21)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Expiry ΓÇ║ should auto-expire jobs after 30 days

    TypeError: _jobService.jobService.checkExpiredJobs is not a function

      382 |       );
      383 |
    > 384 |       const result = await jobService.checkExpiredJobs();
          |                                       ^
      385 |
      386 |       expect(result.expiredJobs).toBeDefined();
      387 |       expect(result.expiredJobs.some(job => job.status === 'expired')).toBe(true);

      at Object.checkExpiredJobs (tests/__tests__/jobs.test.ts:384:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Expiry ΓÇ║ should refund payment on job expiry

    TypeError: _jobService.jobService.expireJob is not a function

      396 |       );
      397 |
    > 398 |       const result = await jobService.expireJob('job-123');
          |                                       ^
      399 |
      400 |       expect(result.refunded).toBe(true);
      401 |       expect(result.refundAmount).toBe(500);

      at Object.expireJob (tests/__tests__/jobs.test.ts:398:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should allow poster to rate worker

    TypeError: _jobService.jobService.rateWorker is not a function

      416 |       );
      417 |
    > 418 |       const result = await jobService.rateWorker('job-123', {
          |                                       ^
      419 |         rating: 5,
      420 |         comment: 'Excellent work!',
      421 |       });

      at Object.rateWorker (tests/__tests__/jobs.test.ts:418:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should allow worker to rate poster

    TypeError: _jobService.jobService.ratePoster is not a function

      436 |       );
      437 |
    > 438 |       const result = await jobService.ratePoster('job-123', {
          |                                       ^
      439 |         rating: 4,
      440 |         comment: 'Good client',
      441 |       });

      at Object.ratePoster (tests/__tests__/jobs.test.ts:438:39)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ Job Lifecycle Tests ΓÇ║ Job Reviews & Ratings ΓÇ║ should prevent duplicate reviews

    TypeError: _jobService.jobService.rateWorker is not a function

      450 |
      451 |       await expect(
    > 452 |         jobService.rateWorker('job-123', { rating: 5 })
          |                    ^
      453 |       ).rejects.toThrow('Review already submitted');
      454 |     });
      455 |   });

      at Object.rateWorker (tests/__tests__/jobs.test.ts:452:20)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

FAIL backend/src/__tests__/middleware/auth.test.ts
  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject request with malformed token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "NO_TOKEN",
    -   "error": "Access denied. Authentication required.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      86 |
      87 |       expect(res.status).toHaveBeenCalledWith(401);
    > 88 |       expect(res.json).toHaveBeenCalledWith({
         |                        ^
      89 |         error: 'Access denied. Authentication required.',
      90 |         code: 'NO_TOKEN'
      91 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:88:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject request with invalid JWT

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "MALFORMED_TOKEN",
    -   "error": "Malformed token.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      105 |
      106 |       expect(res.status).toHaveBeenCalledWith(401);
    > 107 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      108 |         error: 'Malformed token.',
      109 |         code: 'MALFORMED_TOKEN'
      110 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:107:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject expired token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "TOKEN_EXPIRED",
    -   "error": "Token has expired.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      128 |
      129 |       expect(res.status).toHaveBeenCalledWith(401);
    > 130 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      131 |         error: 'Token has expired.',
      132 |         code: 'TOKEN_EXPIRED'
      133 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:130:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject token with invalid payload

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "INVALID_PAYLOAD",
    -   "error": "Invalid token format.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      143 |
      144 |       expect(res.status).toHaveBeenCalledWith(401);
    > 145 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      146 |         error: 'Invalid token format.',
      147 |         code: 'INVALID_PAYLOAD'
      148 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:145:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject when user not found

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "USER_NOT_FOUND",
    -   "error": "User not found.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      159 |
      160 |       expect(res.status).toHaveBeenCalledWith(401);
    > 161 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      162 |         error: 'User not found.',
      163 |         code: 'USER_NOT_FOUND'
      164 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:161:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should reject inactive user

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "code": "ACCOUNT_INACTIVE",
    -   "error": "Account is inactive.",
    +   "code": "INVALID_TOKEN",
    +   "error": "Invalid token.",
      },

    Number of calls: 1

      182 |
      183 |       expect(res.status).toHaveBeenCalledWith(401);
    > 184 |       expect(res.json).toHaveBeenCalledWith({
          |                        ^
      185 |         error: 'Account is inactive.',
      186 |         code: 'ACCOUNT_INACTIVE'
      187 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:184:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should authenticate valid user successfully

    expect(received).toEqual(expected) // deep equality

    Expected: {"currentRank": "G", "email": "test@example.com", "id": "user-123", "isActive": true, "isVerified": 
true, "lastLoginAt": 2025-10-13T19:00:35.975Z}
    Received: undefined

      207 |       await authenticateToken(req, res as Response, mockNext);
      208 |
    > 209 |       expect(req.user).toEqual(mockUser);
          |                        ^
      210 |       expect(mockNext).toHaveBeenCalled();
      211 |       expect(res.status).not.toHaveBeenCalled();
      212 |       expect(mockLogger.debug).toHaveBeenCalledWith(

      at Object.toEqual (backend/src/__tests__/middleware/auth.test.ts:209:24)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should handle database errors gracefully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 401

    Number of calls: 1

      225 |       await authenticateToken(req as AuthenticatedRequest, res as Response, mockNext);
      226 |
    > 227 |       expect(res.status).toHaveBeenCalledWith(500);
          |                          ^
      228 |       expect(res.json).toHaveBeenCalledWith({
      229 |         error: 'Authentication service unavailable.',
      230 |         code: 'AUTH_SERVICE_ERROR'

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:227:26)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should verify JWT with correct options

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-jwt", "test-secret", {"algorithms": ["HS256"], "audience": "test-audience", "issuer": 
"test-issuer"}

    Number of calls: 0

      252 |       await authenticateToken(req as AuthenticatedRequest, res as Response, mockNext);
      253 |
    > 254 |       expect(mockJwt.verify).toHaveBeenCalledWith('valid-jwt', 'test-secret', {
          |                              ^
      255 |         algorithms: ['HS256'],
      256 |         issuer: 'test-issuer',
      257 |         audience: 'test-audience'

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:254:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ authenticateToken ΓÇ║ should update last login timestamp

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"data": {"lastLoginAt": Any<Date>}, "where": {"id": "user-123"}}

    Number of calls: 0

      280 |       await new Promise(resolve => setTimeout(resolve, 10));
      281 |
    > 282 |       expect(mockPrisma.user.update).toHaveBeenCalledWith({
          |                                      ^
      283 |         where: { id: 'user-123' },
      284 |         data: { lastLoginAt: expect.any(Date) }
      285 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:282:38)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ Authentication Middleware ΓÇ║ JWT_SECRET validation ΓÇ║ should exit process if JWT_SECRET is not set

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 1

    Number of calls: 0

      296 |       jest.resetModules();
      297 |       
    > 298 |       expect(process.exit).toHaveBeenCalledWith(1);
          |                            ^
      299 |       
      300 |       // Restore
      301 |       process.exit = originalExit;

      at Object.toHaveBeenCalledWith (backend/src/__tests__/middleware/auth.test.ts:298:28)

FAIL backend/src/__tests__/integration/GIDSystem.integration.test.ts
  ΓùÅ GID System Integration Tests ΓÇ║ Complete User Registration Flow ΓÇ║ should create GID during user registration

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Complete User Registration Flow ΓÇ║ should prevent duplicate GID creation

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ GID Data Linking & Retrieval ΓÇ║ should link all user data to GID

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ GID Data Linking & Retrieval ΓÇ║ should retrieve complete user data by GID

    expect(received).toBe(expected) // Object.is equality

    Expected: "Retrieval Test User"
    Received: undefined

      136 |       const container = await gidService.getGIDContainer(gid);
      137 |
    > 138 |       expect(container?.personalInfo.name).toBe('Retrieval Test User');
          |                                            ^
      139 |       expect(container?.platformData.currentRank).toBe('F');
      140 |       expect(container?.platformData.activityHistory.jobsCompleted).toBe(10);
      141 |     });

      at Object.toBe (backend/src/__tests__/integration/GIDSystem.integration.test.ts:138:44)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Ranking System Integration ΓÇ║ should update user rank through GID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    +   "lastUpdated": 2025-10-13T19:00:36.290Z,
        "platformData.currentRank": "S",
    -   "platformData.lastUpdated": Any<Date>,
    +   "platformData.lastUpdated": 2025-10-13T19:00:36.290Z,
      },

    Number of calls: 1

      180 |       await gidService.updateUserRank(gid, 'S');
      181 |
    > 182 |       expect(mockDb.collection().doc().update).toHaveBeenCalledWith({
          |                                                ^
      183 |         'platformData.currentRank': 'S',
      184 |         'platformData.lastUpdated': expect.any(Date)
      185 |       });

      at Object.toHaveBeenCalledWith (backend/src/__tests__/integration/GIDSystem.integration.test.ts:182:48)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Guild Affiliation Management ΓÇ║ should manage guild memberships through GID

    GID container not found

      372 |       const container = await this.getGIDContainer(gid);
      373 |       if (!container) {
    > 374 |         throw new Error('GID container not found');
          |               ^
      375 |       }
      376 |
      377 |       const guilds = container.platformData.guilds;

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:374:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Performance & Scalability ΓÇ║ should handle bulk GID operations efficiently

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Performance & Scalability ΓÇ║ should maintain data consistency across operations

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Error Handling & Edge Cases ΓÇ║ should validate user data before GID creation

    GID_GENERATION_FAILED

      116 |     } catch (error) {
      117 |       logger.error('Failed to generate GID:', error);
    > 118 |       throw new Error('GID_GENERATION_FAILED');
          |             ^
      119 |     }
      120 |   }
      121 |

      at GIDService.generateGID (backend/src/services/firebase/GIDService.ts:118:13)
      at Object.generateGID (backend/src/__tests__/integration/GIDSystem.integration.test.ts:312:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ GID System Integration Tests ΓÇ║ Privacy & Security ΓÇ║ should maintain audit trail for all GID operations

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID System Integration Tests ΓÇ║ Integration with Existing Systems ΓÇ║ should integrate with user registration 
flow

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

FAIL backend/src/services/firebase/__tests__/GIDService.test.ts
  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ GID Container Creation ΓÇ║ should create complete GID container with all 
data

    GID_COLLISION_DETECTED

      144 |       if (existingGID) {
      145 |         logger.error('GID collision detected', { gid, existingUserId: existingGID.userId, newUserId: 
userId });
    > 146 |         throw new Error('GID_COLLISION_DETECTED');
          |               ^
      147 |       }
      148 |
      149 |       // Create GID data

      at GIDService.<anonymous> (backend/src/services/firebase/GIDService.ts:146:15)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Ranking System Integration ΓÇ║ should update user rank correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    +   "lastUpdated": 2025-10-13T19:00:36.291Z,
        "platformData.currentRank": "F",
    -   "platformData.lastUpdated": Any<Date>,
    +   "platformData.lastUpdated": 2025-10-13T19:00:36.291Z,
      },

    Number of calls: 1

      265 |       await gidService.updateUserRank(gid, newRank);
      266 |
    > 267 |       expect(mockDb.collection().doc().update).toHaveBeenCalledWith({
          |                                                ^
      268 |         'platformData.currentRank': newRank,
      269 |         'platformData.lastUpdated': expect.any(Date)
      270 |       });

      at Object.toHaveBeenCalledWith (backend/src/services/firebase/__tests__/GIDService.test.ts:267:48)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Performance & Scalability ΓÇ║ should maintain cache efficiency

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 2

      316 |       // Second call - cache
      317 |       await gidService.getGIDData(gid);
    > 318 |       expect(mockDb.collection().doc().get).toHaveBeenCalledTimes(1); // Still 1, from cache
          |                                             ^
      319 |     });
      320 |   });
      321 |

      at Object.toHaveBeenCalledTimes (backend/src/services/firebase/__tests__/GIDService.test.ts:318:45)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)

  ΓùÅ GID Service - Comprehensive Testing ΓÇ║ Error Handling & Edge Cases ΓÇ║ should handle invalid user data

    GID_GENERATION_FAILED

      116 |     } catch (error) {
      117 |       logger.error('Failed to generate GID:', error);
    > 118 |       throw new Error('GID_GENERATION_FAILED');
          |             ^
      119 |     }
      120 |   }
      121 |

      at GIDService.generateGID (backend/src/services/firebase/GIDService.ts:118:13)
      at Object.generateGID (backend/src/services/firebase/__tests__/GIDService.test.ts:340:30)
      at asyncGeneratorStep (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (backend/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

FAIL src/__tests__/integration/systemIntegration.test.ts (16.101 s)
  ΓùÅ System Integration Tests ΓÇ║ API Gateway Integration ΓÇ║ should handle secure API requests with validation

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      130 |     it('should handle secure API requests with validation', async () => {
      131 |       // Mock authentication token
    > 132 |       jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                  ^
      133 |
      134 |       // Test API request with input validation
      135 |       const jobData = {

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:132:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ System Integration Tests ΓÇ║ Cross-System Data Flow ΓÇ║ should maintain data consistency across systems

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      282 |     it('should maintain data consistency across systems', async () => {
      283 |       // Mock authentication token
    > 284 |       jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                  ^
      285 |
      286 |       const userId = 'test-user-123';
      287 |       const jobData = {

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:284:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ System Integration Tests ΓÇ║ Error Handling Integration ΓÇ║ should handle authentication errors

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      345 |     it('should handle authentication errors', async () => {
      346 |       // Mock no auth token available
    > 347 |       jest.spyOn(require('../services/secureStorage').secureStorage, 'getItem').mockResolvedValue(null);
          |                  ^
      348 |
      349 |       const response = await api.get('/protected-resource', { requireAuth: true });
      350 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:347:18)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
      at node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
      at Object.<anonymous> (node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)

  ΓùÅ End-to-End User Journeys ΓÇ║ should handle complete user registration and job posting flow

    Cannot find module '../services/secureStorage' from 'src/__tests__/integration/systemIntegration.test.ts'

      509 |     // 3. User posts a job
      510 |     // Mock authentication token for API call
    > 511 |     jest.spyOn(require('../services/secureStorage').secureStorage, 
'getItem').mockResolvedValue('mock-auth-token');
          |                ^
      512 |
      513 |     const jobData = {
      514 |       title: 'Mobile App Developer',

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.require (src/__tests__/integration/systemIntegration.test.ts:511:16)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _next (node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)


Test Suites: 7 failed, 15 passed, 22 total
Tests:       90 failed, 218 passed, 308 total
Snapshots:   0 total
Time:        17.12 s, estimated 22 s
Ran all test suites.
