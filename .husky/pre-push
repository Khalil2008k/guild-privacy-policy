#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running comprehensive pre-push quality checks..."

# Run TypeScript compilation check
echo "ğŸ“ Checking TypeScript compilation..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript compilation failed"
  exit 1
fi

# Run ESLint with SonarLint
echo "ğŸ“‹ Running ESLint with SonarLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint checks failed"
  exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
npm run test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed"
  exit 1
fi

# Run code duplication analysis
echo "ğŸ” Running code duplication analysis..."
npm run analyze:duplication
if [ $? -ne 0 ]; then
  echo "âš ï¸  Code duplication analysis found issues (warning only)"
fi

# Run dependency check
echo "ğŸ§¹ Running dependency cleanup..."
npm run depcheck
if [ $? -ne 0 ]; then
  echo "âŒ Dependency check failed"
  exit 1
fi

# Run security audit
echo "ğŸ”’ Running security audit..."
npm audit --audit-level moderate
if [ $? -ne 0 ]; then
  echo "âŒ Security audit failed"
  exit 1
fi

# Check bundle size (if applicable)
if npm run build --silent 2>/dev/null; then
  echo "ğŸ“¦ Checking bundle size..."
  npm run analyze:bundle
  if [ $? -ne 0 ]; then
    echo "âš ï¸  Bundle size analysis failed (warning only)"
  fi
fi

echo "âœ… All pre-push quality checks passed!"







